<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-11-28T09:32:44.3386449"><title>Cloud Storage | Jetpack Compose</title><script type="application/json" id="virtual-toc-data">[{"id":"key-features-of-firebase-cloud-storage","level":0,"title":"Key Features of Firebase Cloud Storage","anchor":"#key-features-of-firebase-cloud-storage"},{"id":"implementation","level":0,"title":"Implementation","anchor":"#implementation"},{"id":"initialize","level":0,"title":"Initialize","anchor":"#initialize"},{"id":"navigate-with-references","level":0,"title":"Navigate with References","anchor":"#navigate-with-references"},{"id":"reference-properties","level":0,"title":"Reference Properties","anchor":"#reference-properties"},{"id":"uses","level":0,"title":"Uses","anchor":"#uses"},{"id":"download-files","level":0,"title":"Download Files","anchor":"#download-files"},{"id":"delete-a-file","level":0,"title":"Delete a File","anchor":"#delete-a-file"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b518/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Cloud Storage | Jetpack Compose"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Jetpack Compose Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/cloud-storage.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Cloud Storage | Jetpack Compose"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/cloud-storage.html#webpage",
    "url": "writerside-documentation/cloud-storage.html",
    "name": "Cloud Storage | Jetpack Compose",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Jetpack Compose Help"
}</script><!-- End Schema.org --></head><body data-id="Cloud-Storage" data-main-title="Cloud Storage" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Firebase.md|Firebase"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Jetpack Compose  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Cloud-Storage" id="Cloud-Storage.md">Cloud Storage</h1><p id="-d2y2dz_3">Firebase Cloud Storage is a powerful, secure, and scalable object storage service provided by Firebase. It allows you to store and serve user-generated content such as photos, videos, and other files.</p><section class="chapter"><h2 id="key-features-of-firebase-cloud-storage" data-toc="key-features-of-firebase-cloud-storage">Key Features of Firebase Cloud Storage</h2><ul class="list _bullet" id="-d2y2dz_12"><li class="list__item" id="-d2y2dz_13"><p><span class="control" id="-d2y2dz_17">Scalability</span>: Designed to handle large volumes of data with ease, scaling automatically as your app grows.</p></li><li class="list__item" id="-d2y2dz_14"><p><span class="control" id="-d2y2dz_18">Security</span>: Integrated with Firebase Authentication and Google Cloud Identity and Access Management (IAM) to provide fine-grained control over access to your files.</p></li><li class="list__item" id="-d2y2dz_15"><p><span class="control" id="-d2y2dz_19">Reliability</span>: Built on Google Cloud Storage, ensuring high availability and durability of your data.</p></li><li class="list__item" id="-d2y2dz_16"><p><span class="control" id="-d2y2dz_20">Cost-Effective</span>: Pay only for the storage you use, with no minimum fees.</p></li></ul></section><section class="chapter"><h2 id="implementation" data-toc="implementation">Implementation</h2><div class="code-block" data-lang="kotlin">
dependencies {
    // Import the BoM for the Firebase platform
    implementation(platform(&quot;com.google.firebase:firebase-bom:33.1.2&quot;))
    // Add the dependency for the Cloud Storage library
    implementation(&quot;com.google.firebase:firebase-storage&quot;)
}
</div><aside class="prompt" data-type="note" data-title="" id="-d2y2dz_22"><p id="-d2y2dz_23"><span class="control" id="-d2y2dz_25">Note</span></p><p id="-d2y2dz_24">When using the BoM, you don't specify versions in Firebase library dependencies</p></aside></section><section class="chapter"><h2 id="initialize" data-toc="initialize">Initialize</h2><p id="-d2y2dz_26">The first step in accessing your Cloud Storage bucket is to create an instance of FirebaseStorage: There are two ways of creating a storage instance:</p><div class="tabs" id="-d2y2dz_27" data-anchors="[-d2y2dz_29,-d2y2dz_30]"><div class="tabs__content" data-gtm="tab" id="-d2y2dz_29" data-title="Firebase"><div class="code-block" data-lang="kotlin" data-title="Kotlin">
// Using the default Firebase bucket
private val storage = Firebase.storage.reference
// Using a custom Firebase bucket
private val storage = Firebase.storage(&quot;gs://my-custom-bucket&quot;).reference
</div></div><div class="tabs__content" data-gtm="tab" id="-d2y2dz_30" data-title="FireStorage"><div class="code-block" data-lang="kotlin" data-title="Kotlin">
private val storage = FirebaseStorage.getInstance().reference
</div></div></div><p> Next, you can create a reference to a location lower in the tree. You can reference a container or directly reference a file. </p><div class="code-block" data-lang="kotlin">
// Pointing a container (Package)
var packRef: StorageReference? = storage.child(&quot;package&quot;)
// Child references can also take paths
// Pointing a File
var fileRef = storage.child(&quot;package/filename.docs&quot;)
</div></section><section class="chapter"><h2 id="navigate-with-references" data-toc="navigate-with-references">Navigate with References</h2><p id="-d2y2dz_33">You can also use the <code class="code" id="-d2y2dz_37">getParent()</code> and g<code class="code" id="-d2y2dz_38">etRoot()</code> methods to navigate up in our file hierarchy. <code class="code" id="-d2y2dz_39">getParent()</code> navigates up one level, while <code class="code" id="-d2y2dz_40">getRoot()</code> navigates all the way to the top.</p><div class="code-block" data-lang="kotlin">
// parent allows us to move our reference to a parent node
// package now points to 'package'
package = fileRef.parent
...
// root allows us to move all the way back to the top of our bucket
// rootRef now points to the root
val rootRef = spaceRef.root
</div><p id="-d2y2dz_35"><code class="code" id="-d2y2dz_41">child()</code>, <code class="code" id="-d2y2dz_42">getParent()</code>, and <code class="code" id="-d2y2dz_43">getRoot()</code> can be chained together multiple times, as each returns a reference. But calling <code class="code" id="-d2y2dz_44">getRoot().getParent()</code> returns <code class="code" id="-d2y2dz_45">null</code>.</p><div class="code-block" data-lang="kotlin">
// References can be chained together multiple times
// image points to 'package/image.jpg'
val image = fileRef.parent?.child(&quot;image.jpg&quot;)
// nullRef is null, since the parent of root is null
val nullRef = fileRef.root.parent
</div></section><section class="chapter"><h2 id="reference-properties" data-toc="reference-properties">Reference Properties</h2><p id="-d2y2dz_46">You can inspect references to better understand the files they point to using the <code class="code" id="-d2y2dz_48">getPath()</code>, <code class="code" id="-d2y2dz_49">getName()</code>, and <code class="code" id="-d2y2dz_50">getBucket()</code> methods. These methods get the file's full <span class="control" id="-d2y2dz_51">path</span>, <span class="control" id="-d2y2dz_52">name</span> and <span class="control" id="-d2y2dz_53">bucket</span>.</p><div class="code-block" data-lang="kotlin">
// Reference's path is: &quot;package/filename.docs&quot;
// This is analogous to a file path on disk
fileRef.path
// Reference's name is the last segment of the full path: &quot;filename.docs&quot;
// This is analogous to the file name
fileRef.name
// Reference's bucket is the name of the storage bucket that the files are stored in
fileRef.bucket
</div></section><section class="chapter"><h2 id="uses" data-toc="uses">Uses</h2><section class="chapter"><h3 id="adding-a-file" data-toc="adding-a-file">Adding a File</h3><p id="-d2y2dz_57">To upload a file to Cloud Storage, you first create a reference to the full path of the file, including the file name.</p><p id="-d2y2dz_58">If you need to save the uploaded file reference into a database, it is necessary to get the file URL from the Cloud Storage.</p><div class="code-block" data-lang="kotlin">
private suspend fun uploadImage(image: Uri): String {
        return try {
            val imageRef = storage.child(&quot;images/${UUID.randomUUID()}&quot;)
            val taskSnapshot = imageRef.putFile(image).await()
            val downloadUri = taskSnapshot.metadata?.reference?.downloadUrl?.await()
            downloadUri.toString()
        } catch (e: Exception) {
            &quot;&quot;
        }
    }
</div><p id="-d2y2dz_60"><span class="control" id="-d2y2dz_64">Where:</span></p><ul class="list _bullet" id="-d2y2dz_61"><li class="list__item" id="-d2y2dz_65"><p><code class="code" id="-d2y2dz_70">val imageRef = storage.child(&quot;images/${UUID.randomUUID()}&quot;)</code>: Creates the reference where te file will be contained, it means, where the file wil be saved (Bucket and file name).</p></li><li class="list__item" id="-d2y2dz_66"><p><code class="code" id="-d2y2dz_71">UUID.randomUUID()</code>: It is a Java class that creates a random ID, it can be replaced with un unique File name.</p></li><li class="list__item" id="-d2y2dz_67"><p><code class="code" id="-d2y2dz_72">val taskSnapshot = ...</code>: Contains the handler that allows to control de file state while it is being saved.</p></li><li class="list__item" id="-d2y2dz_68"><p><code class="code" id="-d2y2dz_73">imageRef.putFile(image).await()</code>: Save the file into the reference.</p></li><li class="list__item" id="-d2y2dz_69"><p><code class="code" id="-d2y2dz_74">taskSnapshot.metadata?.reference?.downloadUrl?.await()</code> Get the File URL.</p></li></ul><section class="chapter"><h4 id="upload-from-data-in-memory" data-toc="upload-from-data-in-memory">Upload from data in memory</h4><p id="-d2y2dz_75">The <code class="code" id="-d2y2dz_78">putBytes()</code> method is the simplest way to upload a file to Cloud Storage. <code class="code" id="-d2y2dz_79">putBytes()</code> takes a <code class="code" id="-d2y2dz_80">byte[]</code> and returns an <code class="code" id="-d2y2dz_81">UploadTask</code> that you can use to manage and monitor the status of the upload.</p><div class="code-block" data-lang="kotlin">
// Get the data from an ImageView as bytes
imageView.isDrawingCacheEnabled = true
imageView.buildDrawingCache()
val bitmap = (imageView.drawable as BitmapDrawable).bitmap
val baos = ByteArrayOutputStream()
bitmap.compress(Bitmap.CompressFormat.JPEG, 100, baos)
val data = baos.toByteArray()
var uploadTask = mountainsRef.putBytes(data)
uploadTask.addOnFailureListener {
// Handle unsuccessful uploads
}.addOnSuccessListener { taskSnapshot -&gt;
// taskSnapshot.metadata contains file metadata such as size, content-type, etc.
// ...
}</div><p> Because `putBytes()` accepts a` byte[]`, it requires your app to hold the entire contents of a file in memory at once. Consider using `putStream()` or `putFile()` to use less memory. #### Upload from a stream The `putStream()` method is the most versatile way to upload a file to Cloud Storage. `putStream()` takes an `InputStream` and returns an `UploadTask` that you can use to manage and monitor the status of the upload. </p><div class="code-block" data-lang="kotlin">
val stream = FileInputStream(File(&quot;path/to/files/file.extension&quot;))
uploadTask = mountainsRef.putStream(stream)
uploadTask.addOnFailureListener {
// Handle unsuccessful uploads
}.addOnSuccessListener { taskSnapshot -&gt;
// taskSnapshot.metadata contains file metadata such as size, content-type, etc.
// ...
}
</div></section><section class="chapter"><h4 id="upload-from-a-local-file" data-toc="upload-from-a-local-file">Upload from a local file</h4><p id="-d2y2dz_82">You can upload local files on the device, such as photos and videos from the camera, with the <code class="code" id="-d2y2dz_84">putFile()</code> method. <code class="code" id="-d2y2dz_85">putFile()</code> takes a File and returns an <code class="code" id="-d2y2dz_86">UploadTask</code> which you can use to manage and monitor the status of the upload.</p><div class="code-block" data-lang="kotlin">
var file = Uri.fromFile(File(&quot;path/to/images/image.jpg&quot;))
val riversRef = storageRef.child(&quot;images/${file.lastPathSegment}&quot;)
uploadTask = riversRef.putFile(file)
// Register observers to listen for when the download is done or if it fails
uploadTask.addOnFailureListener {
// Handle unsuccessful uploads
}.addOnSuccessListener { taskSnapshot -&gt;
// taskSnapshot.metadata contains file metadata such as size, content-type, etc.
// ...
}
</div></section></section><section class="chapter"><h3 id="get-a-download-url" data-toc="get-a-download-url">Get a download URL</h3><p id="-d2y2dz_87">After uploading a file, you can get a URL to download the file by calling the getDownloadUrl() method on the StorageReference:</p><div class="code-block" data-lang="kotlin">
val ref = storageRef.child(&quot;images/image.jpg&quot;)
uploadTask = ref.putFile(file)
val urlTask = uploadTask.continueWithTask { task -&gt;
  if (!task.isSuccessful) {
    task.exception?.let {
      throw it
    }
  }
  ref.downloadUrl
}.addOnCompleteListener { task -&gt;
  if (task.isSuccessful) {
    val downloadUri = task.result
  } else {
    // Handle failures
    // ...
  }
}
</div></section><section class="chapter"><h3 id="manage-uploads" data-toc="manage-uploads">Manage Uploads</h3><p id="-d2y2dz_89">In addition to starting uploads, you can pause, resume, and cancel uploads using the <code class="code" id="-d2y2dz_95">pause()</code>, <code class="code" id="-d2y2dz_96">resume()</code>, and <code class="code" id="-d2y2dz_97">cancel()</code> methods. Pause and resume events raise pause and progress state changes respectively. Canceling an upload causes the upload to fail with an error indicating that the upload was canceled.</p><div class="code-block" data-lang="kotlin">
// The file is still the same as above
uploadTask = storageRef.child(&quot;images/image.jpg&quot;).putFile(file)
// Pause the upload
uploadTask.pause()
// Resume the upload
uploadTask.resume()
// Cancel the upload
uploadTask.cancel()
</div><p id="-d2y2dz_91">Read more about <a href="https://firebase.google.com/docs/storage/android/upload-files#monitor_upload_progress" id="-d2y2dz_98" data-external="true" rel="noopener noreferrer">How to monitor the upload progress</a></p><p id="-d2y2dz_92">The UploadTask event listeners provide a simple and powerful way to monitor upload events.</p><div class="code-block" data-lang="kotlin">
uploadTask.addOnProgressListener { (bytesTransferred, totalByteCount) -&gt;
    val progress = (100.0 * bytesTransferred) / totalByteCount
    Log.d(TAG, &quot;Upload is $progress% done&quot;)
}.addOnPausedListener {
    Log.d(TAG, &quot;Upload is paused&quot;)
}
</div><aside class="prompt" data-type="note" data-title="" id="-d2y2dz_94"><p id="-d2y2dz_99"><span class="control" id="-d2y2dz_102">Note</span></p><p id="-d2y2dz_100">Observe state change events such as progress, pause, and resume</p><p id="-d2y2dz_101">You'll need to import<code class="code" id="-d2y2dz_103">com.google.firebase.storage.component1</code> and <code class="code" id="-d2y2dz_104">com.google.firebase.storage.component2</code></p></aside></section></section><section class="chapter"><h2 id="download-files" data-toc="download-files">Download Files</h2><p id="-d2y2dz_105">To download a file, first create a Cloud Storage reference to the file you want to download.</p><p id="-d2y2dz_106">You can create a reference by appending child paths to the root of your Cloud Storage bucket, or you can create a reference from an existing <code class="code" id="-d2y2dz_112">gs://</code> or <code class="code" id="-d2y2dz_113">https://</code> URL referencing an object in Cloud Storage.</p><div class="code-block" data-lang="kotlin">
// Create a storage reference from our app
val storageRef = storage.reference
// Create a reference with an initial file path and name
val pathReference = storageRef.child(&quot;images/image.jpg&quot;)
// Create a reference to a file from a Google Cloud Storage URI
val gsReference = storage.getReferenceFromUrl(&quot;gs://bucket/images/image.jpg&quot;)
// Create a reference from an HTTPS URL
val httpsReference = storage.getReferenceFromUrl(
&quot;https://firebasestorage.googleapis.com/b/bucket/o/images%20image.jpg&quot;,)
// Note that in the URL, characters are URL escaped!
</div><p id="-d2y2dz_108">Once you have a reference, you can download files from Cloud Storage by calling the <code class="code" id="-d2y2dz_114">getBytes()</code> or <code class="code" id="-d2y2dz_115">getStream()</code>. If you prefer to download the file with another library, you can get a download URL with <code class="code" id="-d2y2dz_116">getDownloadUrl()</code>.</p><section class="chapter"><h3 id="download-in-memory" data-toc="download-in-memory">Download in memory</h3><p id="-d2y2dz_117">Download the file to a <code class="code" id="-d2y2dz_119">byte[]</code> with the <code class="code" id="-d2y2dz_120">getBytes()</code> method. This is the easiest way to download a file, but it must load the entire contents of your file into memory. If you request a file larger than your app's available memory, your app will crash. To protect against memory issues, <code class="code" id="-d2y2dz_121">getBytes()</code> takes a maximum amount of bytes to download. Set the maximum size to something you know your app can handle, or use another download method.</p><div class="code-block" data-lang="kotlin">
var fileRef = storageRef.child(&quot;images/image.jpg&quot;)
// maximum amount of bytes to download
val ONE_MEGABYTE: Long = 1024 * 1024
fileRef.getBytes(ONE_MEGABYTE).addOnSuccessListener {
  // Data for &quot;images/image.jpg&quot; is returned, use this as needed
}.addOnFailureListener {
  // Handle any errors
}
</div></section><section class="chapter"><h3 id="download-to-a-local-file" data-toc="download-to-a-local-file">Download to a local file</h3><p id="-d2y2dz_122">The<code class="code" id="-d2y2dz_124">getFile()</code> method downloads a file directly to a local device. Use this if your users want to have access to the file while offline or to share the file in a different app. <code class="code" id="-d2y2dz_125">getFile()</code> returns a <code class="code" id="-d2y2dz_126">DownloadTask</code> which you can use to manage your download and monitor the status of the download.</p><div class="code-block" data-lang="kotlin">
imageRef = storageRef.child(&quot;images/image.jpg&quot;)
val localFile = File.createTempFile(&quot;images&quot;, &quot;jpg&quot;)
imageRef.getFile(localFile).addOnSuccessListener {
// Local temp file has been created
}.addOnFailureListener {
// Handle any errors
}
</div></section><section class="chapter"><h3 id="download-data-via-url" data-toc="download-data-via-url">Download Data via URL</h3><p id="-d2y2dz_127">If you already have download infrastructure based around URLs, or just want a URL to share, you can get the download URL for a file by calling the <code class="code" id="-d2y2dz_129">getDownloadUrl()</code> method on a Cloud Storage reference.</p><div class="code-block" data-lang="kotlin">
storageRef.child(&quot;users/me/profile.png&quot;).downloadUrl.addOnSuccessListener {
    // Got the download URL for 'users/me/profile.png'
}.addOnFailureListener {
    // Handle any errors
}
</div></section></section><section class="chapter"><h2 id="delete-a-file" data-toc="delete-a-file">Delete a File</h2><p id="-d2y2dz_130">To delete a file, first create a reference. to that file. Then call the<code class="code" id="-d2y2dz_136">delete()</code> method on that reference.</p><p id="-d2y2dz_131">When you have the file URL and do not know its reference you can use the following:</p><div class="code-block" data-lang="kotlin">
private suspend fun deleteImage(imageUri: String) {
        val imgRef = storage.child(imageUri.toUri().lastPathSegment ?: &quot;&quot;)
        try {
            imgRef.delete()
        } catch (e: Exception) {
           // Handle errors
        }
    }
</div><p id="-d2y2dz_133">If you know the reference to file use the following:</p><div class="code-block" data-lang="kotlin">
// Create a storage reference from our app
val storageRef = storage.reference
// Create a reference to the file to delete
val imgRef = storageRef.child(&quot;images/image.jpg&quot;)
// Delete the file
imgRef.delete().addOnSuccessListener {
// File deleted successfully
}.addOnFailureListener {
// Uh-oh, an error occurred!
}
</div><ul class="list _bullet" id="-d2y2dz_135"><li class="list__item" id="-d2y2dz_137"><p><a href="https://firebase.google.com/docs/firestore" id="-d2y2dz_138" data-external="true" rel="noopener noreferrer">Read more</a></p></li></ul></section><div class="last-modified">Last modified: 28 noviembre 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="cloud-firestore.html" class="navigation-links__prev">Cloud Firestore</a><a href="admob.html" class="navigation-links__next">TODO : AdMob</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b518/app.js"></script></body></html>